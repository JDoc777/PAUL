import serial
import time
import gpiozero as LED 

# Set up GPIO
led = LED(18)


# Open the serial connection to the Arduino
arduino_serial = serial.Serial('/dev/ttyAMA0', 115200, timeout=1)
arduino_serial.flush()

# Counter for button presses
count = 0

def update_pi_led_on():
   led.on()
   print("LED is on")
def update_pi_led_off():
    led.off()
    print("LED is off")
try:
    while True:
        if (arduino_serial.in_waiting > 0):
            incoming = arduino_serial.read().decode('utf-8')

            if incoming == 'B': # Button pressed
                # Toggle Raspberry Pi's LED
                update_pi_led_on(True)
                time.sleep(0.1)
                update_pi_led_off(False)

                # Increment the button press counter and calculate binary state
                count += 1
                led_state = count % 8   # Wrap around every 8 (3-bit binary: 0-7)

                # Send the binary count to Arduino
                arduino_serial.write(bytes([led_state]))

except KeyboardInterrupt:
    
    arduino_serial.close()
finally:
    
    arduino_serial.close()
